---
layout: post
title:  "ä¸ºFlutterè€Œç”Ÿçš„è½»é‡çº§ä¾èµ–æ£€ç´¢å®¹å™¨â€”DartIn"
date:   2019-03-22 10:18:00
categories: DI Flutter
---

Flutter æ˜¯ Googleæ¨å‡ºå¹¶å¼€æºçš„ç§»åŠ¨åº”ç”¨å¼€å‘æ¡†æ¶ï¼Œä¸»æ‰“è·¨å¹³å°ã€é«˜ä¿çœŸã€é«˜æ€§èƒ½ã€‚å¼€å‘è€…å¯ä»¥é€šè¿‡ Dartè¯­è¨€å¼€å‘ Appï¼Œä¸€å¥—ä»£ç åŒæ—¶è¿è¡Œåœ¨ iOS å’Œ Androidå¹³å°ã€‚

> Flutterå®˜ç½‘ï¼š[https://flutter-io.cn](https://flutter-io.cn/)

åœ¨å­¦ä¹ Flutterä¸€æ®µæ—¶é—´ä¹‹åï¼Œæˆ‘ä»¬å·²ç»åœ¨å®é™…é¡¹ç›®ä¸­è¿›è¡Œäº†å®è·µï¼Œæ•ˆæœè¿˜æ˜¯è›®ä¸é”™çš„ï¼š**æ— å·®çš„UIã€åŒæ ·çš„ä¸šåŠ¡é€»è¾‘ã€å‡å°‘æ²Ÿé€šäº¤æµçš„æˆæœ¬ã€HotReload**ç­‰ç­‰éƒ½æ˜¯ä»¤äººæ„¿æ„ç»§ç»­æ·±è€•çš„ç†ç”±

ä½†ä¸Android/IOSç­‰å‘å±•å¤šå¹´ã€ç¨³å®šé«˜æ•ˆçš„å¼€å‘æ¨¡å¼ç›¸æ¯”ï¼Œæ— ç–‘è¿˜å¤„åœ¨æ–°ç”Ÿé˜¶æ®µã€‚åœ¨ç¼–å†™Dartä»£ç çš„è¿™æ®µæ—¶é—´ä¸­ï¼Œæˆ‘å°è¯•å°†ä»¥å‰çš„å¼€å‘ç»éªŒè¿ç§»åˆ°Flutteré¡¹ç›®ä¸­ï¼Œå…¶ä¸­è‡ªç„¶ä¹ŸåŒ…æ‹¬ä¾èµ–æ³¨å…¥çš„æ€æƒ³ï¼Œä½†å‘ç°ç¤¾åŒºè¿˜æ²¡æœ‰æä¾›è¿™æ ·çš„ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œä½†å®é™…æ˜¯æœ‰è¿™æ–¹é¢éœ€æ±‚çš„ï¼Œåœ¨googleå…³äºflutterç¬¬äºŒæœŸçš„é—®ç­”ä¸­ï¼Œä¹Ÿæåˆ°äº†ç›¸å…³çš„é—®é¢˜ã€‚

![issue](https://upload-images.jianshu.io/upload_images/3722695-010f2a923d23db8a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

å› ä¸ºä»¥å‰æœ‰å†™è¿‡åˆ†æKoinä¾èµ–æ£€ç´¢åŸç†çš„æ–‡ç« ([å½“Koinæ’ä¸ŠViewModel)](https://www.jianshu.com/p/80c4852cbd95)ï¼Œæœ‰è¿™æ–¹é¢çŸ¥è¯†çš„ç§¯ç´¯ã€‚åŠ ä¸Šè¿‘æœŸåœ¨è¿ç”¨[flutter-provide](https://github.com/google/flutter-provide)è¿›è¡ŒçŠ¶æ€ç®¡ç†çš„è¿‡ç¨‹ä¸­å‘ç°provideç¨åŠ æ”¹è¿›ä¾¿å¯ä»¥åŒ–èº«ä¸ºä¸€ä¸ªä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œäºæ˜¯æˆ‘ä¾¿åŠ¨æ‰‹è¿›è¡Œäº†è¿™æ–¹é¢çš„æ”¹é€ ã€‚

### DartIn

çµæ„Ÿæ¥è‡ªäº[Koin](https://github.com/InsertKoinIO/koin)ï¼ˆä¸€ä¸ªä¸ºKotlinå¼€å‘è€…æä¾›çš„è½»é‡çº§ä¾èµ–æ£€ç´¢å®¹å™¨ï¼‰ã€‚

ç”¨æ³•ä¹Ÿè·ŸKoinç±»ä¼¼ï¼Œä»£ç æ€»å…±å°±261è¡Œï¼ˆåŒ…æ‹¬æ³¨é‡Šï¼‰ï¼Œæ˜“äºä½¿ç”¨ä¹Ÿæ–¹ä¾¿ç†è§£ã€‚

> githubåœ°å€ï¼š**https://github.com/ditclear/dartin**

dartinå·²ç»ä¸Šä¼ åˆ°pubï¼Œæ–¹ä¾¿Flutterå¼€å‘è€…é›†æˆã€‚

```yaml
dependencies:
  dartin: ^0.1.0
```

ä¸€äº›å…³é”®çš„æ–¹æ³•ï¼š

- **single**ï¼šåˆ›å»ºä¸€ä¸ªæä¾›å…¨å±€å”¯ä¸€çš„å®ä¾‹çš„providerã€‚
- **lazy**ï¼šåˆ›å»ºä¸€ä¸ªproviderï¼Œå½“ç¬¬ä¸€æ¬¡ä½¿ç”¨åˆ°å®ƒçš„æ—¶å€™æ‰ä¼šåˆ›å»ºå®ä¾‹ã€‚
- **factory**ï¼šåˆ›å»ºä¸€ä¸ªproviderï¼Œæ¯æ¬¡éƒ½ä¼šæä¾›æ–°çš„å®ä¾‹ã€‚
- **inject**<T>ï¼šæ³¨å…¥å¯¹è±¡

æ›´å¤šä¿¡æ¯å¯ä»¥æŸ¥çœ‹[dartin.dart](https://github.com/ditclear/dartin/blob/master/lib/dartin.dart)ã€‚

### å¿«é€Ÿå¼€å§‹

1. åˆ›å»ºModuleï¼Œé…ç½®ä¾èµ–

```dart
//scope å¿…é¡»æ˜¯å…¨å±€çš„ï¼Œå¹¶ä¸”æ˜¯é™æ€ä¸å¯å˜çš„
const test = DartInScope('test');

//åœ¨Moduleæ„é€ æ–¹æ³•ä¸­å®šä¹‰çš„ä¾èµ–é…ç½®ä¼šæ”¾åˆ°é»˜è®¤çš„ä½œç”¨åŸŸ_defauleä¸­
final viewModelModule = Module([
  factory<HomeProvide>(({params}) => HomeProvide(params.get(0), get<GithubRepo>())),
])
  ..withScope(test , [
    ///other scope
   factory<HomeProvide>(({params}) => HomeProvide(params.get(0), get<GithubRepo>())),
  ]);

final repoModule = Module([
  lazy<GithubRepo>(({params}) => GithubRepo(get<GithubService>())),
]);

final remoteModule = Module([
  single<GithubService>(GithubService()),
]);

final appModule = [viewModelModule, repoModule, remoteModule];
```

2. åŠ è½½é…ç½®é¡¹åˆ°dartins

```dart
void main() {
  startDartIn(appModule);
  runApp(MyApp());
}
```

3. è¿›è¡Œä¾èµ–æ£€ç´¢æ³¨å…¥å®ä¾‹

```dart
//æ³¨å…¥ä¸€ä¸ªç®€å•çš„å®ä¾‹
final service = inject<GithubService>();
//åŠ¨æ€æä¾›å‚æ•°
final test = inject<HomeProvide>(params: ['title']);
//æ ¹æ®scopeæä¾›ä¸åŒçš„å®ä¾‹
final test = inject<HomeProvide>(scope:test, params: ['title']);
```

æ›´å¤šçš„ä¾‹å­å¯ä»¥æŸ¥çœ‹ <https://github.com/ditclear/mvvm_flutter>

åŸç†å¾ˆç®€å•ï¼Œæ€»çš„æ¥è¯´å°±æ˜¯ä¸€ä¸ªä¾èµ–å®¹å™¨Mapï¼Œ**keyä¸ºé…ç½®çš„ä¾èµ–ç±»å‹ï¼Œå€¼ä¸ºå°è£…çš„ä¸€å±‚Provider**ã€‚

> factory<HomeProvide>(({params}) => HomeProvide(params.get(0), get<GithubRepo>()))
>
> Key å°±æ˜¯ HomeProvider ï¼Œ å€¼æ˜¯factoryè¿”å›çš„ä¸€ä¸ªProvider

å½“éœ€è¦è·å–å®ä¾‹çš„æ—¶å€™ï¼Œé€šè¿‡éœ€è¦å®ä¾‹çš„runtimeTypeï¼Œé€šè¿‡Provider.get()æ–¹æ³•æ ¹æ®æ˜¯single/lazy/factoryå»æä¾›ç›¸åº”çš„å®ä¾‹ï¼Œæ‰€ä»¥è®°ä½**å†™å¥½<T>å¾ˆé‡è¦**ã€‚

### å†™åœ¨æœ€å

DartInæ˜¯ç«™åœ¨å·¨äººè‚©è†€ä¸Šçš„äº§ç‰©ï¼ŒåŠŸèƒ½æœ‰äº†ï¼Œä½†å’ŒKoinè¿™ç§æ¡†æ¶æ¯”è¾ƒèµ·æ¥è¿˜æœ‰è®¸å¤šéœ€æ›´è¿›ä¸€æ­¥ï¼ŒåŒ…æ‹¬å®Œå–„çš„å•å…ƒæµ‹è¯•ã€ç±»å‹å®‰å…¨ã€æ›´åˆç†çš„æç¤ºï¼Œä¾èµ–æ„å»ºçš„è·¯å¾„æä¾›ï¼Œä»Šåæˆ‘ä¹Ÿå°†æŒç»­å®Œå–„å®ƒï¼Œä¹Ÿå¸Œæœ›èƒ½æŠ›ç –å¼•ç‰ï¼Œæ—©æ—¥å‡ºç°æ›´å¥½çš„ä¾èµ–æ³¨å…¥æ¡†æ¶ã€‚

æœ€åğŸº welcome to starã€ fork and pull request.